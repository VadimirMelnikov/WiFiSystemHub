<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>–°–∏—Å—Ç–µ–º–∞ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 0;
            background-color: #f4f4f4;
        }
        .container {
            max-width: 1200px;
            margin: 20px auto;
            padding: 20px;
            background-color: white;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
        }
        h1 {
            text-align: center;
            margin-bottom: 20px;
        }
        table {
            width: 100%;
            border-collapse: collapse;
        }
        th, td {
            border: 1px solid #ddd;
            padding: 8px;
            text-align: left;
        }
        th {
            background-color: #f2f2f2;
        }
        .status-icon {
            font-size: 20px;
            color: inherit;
        }
        .green { color: green; }
        .red { color: red; }
        .yellow { color: orange; }
        .gray { color: gray; }

        .filters {
            margin-bottom: 15px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>–°–∏—Å—Ç–µ–º–∞ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞</h1>

        <!-- –§–∏–ª—å—Ç—Ä—ã -->
        <div class="filters">
            <label for="group-filter">–§–∏–ª—å—Ç—Ä –ø–æ –≥—Ä—É–ø–ø–µ:</label>
            <select id="group-filter" onchange="applyFilter()">
                <option value="">–í—Å–µ –≥—Ä—É–ø–ø—ã</option>
            </select>
        </div>

        <!-- –¢–∞–±–ª–∏—Ü–∞ -->
        <table id="sensors-table">
            <thead>
                <tr>
                    <th>ID</th>
                    <th>–ì—Ä—É–ø–ø–∞ –¥–∞—Ç—á–∏–∫–æ–≤</th>
                    <th>–ó–Ω–∞—á–µ–Ω–∏–µ</th>
                    <th>–ï–¥. –∏–∑–º–µ—Ä–µ–Ω–∏—è</th>
                    <th>–°–æ—Å—Ç–æ—è–Ω–∏–µ</th>
                </tr>
            </thead>
            <tbody></tbody>
        </table>
    </div>

    <script>
        let allSensors = [];

        async function fetchSensorData() {
            try {
                const response = await fetch('/view');
                if (!response.ok) throw new Error("–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö");

                allSensors = await response.json();
                populateGroups(); // –ó–∞–ø–æ–ª–Ω—è–µ–º —Å–ø–∏—Å–æ–∫ –≥—Ä—É–ø–ø
                applyFilter();     // –ü—Ä–∏–º–µ–Ω—è–µ–º —Ç–µ–∫—É—â–∏–π —Ñ–∏–ª—å—Ç—Ä
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞:', error);
            }
        }

        function populateGroups() {
            const groupSelect = document.getElementById('group-filter');
            const groups = [...new Set(allSensors.map(s => s.group))];

            groupSelect.innerHTML = '<option value="">–í—Å–µ –≥—Ä—É–ø–ø—ã</option>';
            groups.forEach(group => {
                const option = document.createElement('option');
                option.value = group;
                option.textContent = group;
                groupSelect.appendChild(option);
            });
        }

        function applyFilter() {
            const selectedGroup = document.getElementById('group-filter').value;
            const tbody = document.querySelector('#sensors-table tbody');
            tbody.innerHTML = '';

            const filtered = selectedGroup
                ? allSensors.filter(s => s.group === selectedGroup)
                : allSensors;

            filtered.forEach(sensor => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${sensor.id}</td>
                    <td>${sensor.group}</td>
                    <td>${sensor.value.toFixed(2)}</td>
                    <td>${sensor.unit}</td>
                    <td>
                        <span class="status-icon ${getStatusClass(sensor.status)}">
                            ${getStatusIcon(sensor.status)}
                        </span>
                    </td>
                `;
                tbody.appendChild(row);
            });
        }

        function getStatusClass(status) {
            switch (status) {
                case 'active': return 'green';
                case 'inactive': return 'red';
            }
        }

        function getStatusIcon(status) {
            switch (status) {
                case 'active': return 'üü¢';
                case 'inactive': return 'üî¥';
            }
        }

        // –ü–µ—Ä–≤—ã–π –≤—ã–∑–æ–≤ –∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∫–∞–∂–¥—ã–µ 5 —Å–µ–∫—É–Ω–¥
        fetchSensorData();
        setInterval(fetchSensorData, 5000);
    </script>
</body>
</html>
<!--<!DOCTYPE html>-->
<!--<html lang="ru">-->
<!--<head>-->
<!--    <meta charset="UTF-8">-->
<!--    <meta name="viewport" content="width=device-width, initial-scale=1.0">-->
<!--    <title>–°–∏—Å—Ç–µ–º–∞ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞</title>-->
<!--    <style>-->
<!--        body {-->
<!--            font-family: Arial, sans-serif;-->
<!--            margin: 0;-->
<!--            padding: 0;-->
<!--            background-color: #f4f4f4;-->
<!--        }-->
<!--        .container {-->
<!--            max-width: 1200px;-->
<!--            margin: 20px auto;-->
<!--            padding: 20px;-->
<!--            background-color: white;-->
<!--            box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);-->
<!--        }-->
<!--        h1 {-->
<!--            text-align: center;-->
<!--            margin-bottom: 20px;-->
<!--        }-->
<!--        .sidebar {-->
<!--            width: 25%;-->
<!--            float: left;-->
<!--            padding: 10px;-->
<!--            border: 1px solid #ddd;-->
<!--            margin-right: 20px;-->
<!--        }-->
<!--        .main-content {-->
<!--            width: 100%;-->
<!--            float: right;-->
<!--        }-->
<!--        table {-->
<!--            width: 100%;-->
<!--            border-collapse: collapse;-->
<!--        }-->
<!--        th, td {-->
<!--            border: 1px solid #ddd;-->
<!--            padding: 8px;-->
<!--            text-align: left;-->
<!--        }-->
<!--        th {-->
<!--            background-color: #f2f2f2;-->
<!--        }-->
<!--        .status-icon {-->
<!--            font-size: 20px;-->
<!--            color: inherit;-->
<!--        }-->
<!--        .green { color: green; }-->
<!--        .red { color: red; }-->
<!--        .yellow { color: orange; }-->
<!--        .gray { color: gray; }-->
<!--        .export-button {-->
<!--            margin-top: 20px;-->
<!--            padding: 10px;-->
<!--            background-color: #f2f2f2;-->
<!--            border: 1px solid #ddd;-->
<!--            cursor: pointer;-->
<!--        }-->
<!--    </style>-->
<!--</head>-->
<!--<body>-->
<!--    <div class="container">-->
<!--        <h1>–°–∏—Å—Ç–µ–º–∞ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞</h1>-->

<!--        &lt;!&ndash; –ë–æ–∫–æ–≤–∞—è –ø–∞–Ω–µ–ª—å &ndash;&gt;-->
<!--&lt;!&ndash;        <div class="sidebar">&ndash;&gt;-->
<!--&lt;!&ndash;            <p><strong>–§–µ—Ä–º–∞</strong></p>&ndash;&gt;-->
<!--&lt;!&ndash;            <p>–í —Å–∏—Å—Ç–µ–º—É –ø–æ–¥–∫–ª—é—á–µ–Ω–æ<br>{{ sensors_data|length }} –¥–∞—Ç—á–∏–∫–æ–≤</p>&ndash;&gt;-->
<!--&lt;!&ndash;            <p>‚ö† –ü—Ä–µ–≤—ã—à–µ–Ω–∏–µ –ø–æ–∫–∞–∑–∞—Ç–µ–ª—è —É<br>–¥–∞—Ç—á–∏–∫–∞ 2</p>&ndash;&gt;-->
<!--&lt;!&ndash;            <p>‚ö† –û—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫<br>–¥–∞—Ç—á–∏–∫—É 3</p>&ndash;&gt;-->
<!--&lt;!&ndash;            <hr>&ndash;&gt;-->
<!--&lt;!&ndash;            <p>{{ current_time }}</p>&ndash;&gt;-->
<!--&lt;!&ndash;            <button class="export-button">–≠–∫—Å–ø–æ—Ä—Ç –¥–∞–Ω–Ω—ã—Ö –≤ –æ–±–ª–∞–∫–æ</button>&ndash;&gt;-->
<!--&lt;!&ndash;        </div>&ndash;&gt;-->

<!--        &lt;!&ndash; –û—Å–Ω–æ–≤–Ω–æ–µ —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ &ndash;&gt;-->
<!--        <div class="main-content">-->
<!--            <table>-->
<!--                <thead>-->
<!--                    <tr>-->
<!--                        <th>ID</th>-->
<!--                        <th>–ì—Ä—É–ø–ø–∞ –¥–∞—Ç—á–∏–∫–æ–≤</th>-->
<!--                        <th>–ó–Ω–∞—á–µ–Ω–∏–µ</th>-->
<!--                        <th>–ï–¥. –∏–∑–º–µ—Ä–µ–Ω–∏—è</th>-->
<!--                        <th>–°–æ—Å—Ç–æ—è–Ω–∏–µ</th>-->
<!--                    </tr>-->
<!--                </thead>-->
<!--                <tbody>-->
<!--&lt;!&ndash;                    {% for sensor in sensors_data %}&ndash;&gt;-->
<!--&lt;!&ndash;                    <tr>&ndash;&gt;-->
<!--&lt;!&ndash;                        <td>{{ sensor.id }}</td>&ndash;&gt;-->
<!--&lt;!&ndash;                        <td>{{ sensor.group }}</td>&ndash;&gt;-->
<!--&lt;!&ndash;                        <td>{{ sensor.value }}</td>&ndash;&gt;-->
<!--&lt;!&ndash;                        <td>{{ sensor.unit }}</td>&ndash;&gt;-->
<!--&lt;!&ndash;                        <td>&ndash;&gt;-->
<!--&lt;!&ndash;                            <span class="status-icon {{ sensor.status }}">&ndash;&gt;-->
<!--&lt;!&ndash;                                {{ sensor.status_icon }}&ndash;&gt;-->
<!--&lt;!&ndash;                            </span>&ndash;&gt;-->
<!--&lt;!&ndash;                        </td>&ndash;&gt;-->
<!--&lt;!&ndash;                    </tr>&ndash;&gt;-->
<!--&lt;!&ndash;                    {% endfor %}&ndash;&gt;-->
<!--                </tbody>-->
<!--            </table>-->
<!--        </div>-->
<!--<script>-->
<!--    async function fetchSensorData() {-->
<!--        try {-->
<!--            const response = await fetch('/view');-->
<!--            if (!response.ok) throw new Error("–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö");-->

<!--            const sensors = await response.json();-->
<!--            updateTable(sensors);-->
<!--        } catch (error) {-->
<!--            console.error('–û—à–∏–±–∫–∞:', error);-->
<!--        }-->
<!--    }-->

<!--    function updateTable(sensors) {-->
<!--        const tbody = document.querySelector('#sensors-table tbody');-->
<!--        tbody.innerHTML = ''; // –û—á–∏—Å—Ç–∫–∞ –ø—Ä–µ–¥—ã–¥—É—â–∏—Ö –¥–∞–Ω–Ω—ã—Ö-->

<!--        sensors.forEach(sensor => {-->
<!--            const row = document.createElement('tr');-->

<!--            row.innerHTML = `-->
<!--                <td>${sensor.id}</td>-->
<!--                <td>${sensor.group}</td>-->
<!--                <td>${sensor.value}</td>-->
<!--                <td>${sensor.unit}</td>-->
<!--                <td>-->
<!--                    <span class="status-icon ${getStatusClass(sensor.status)}">-->
<!--                        ${getStatusIcon(sensor.status)}-->
<!--                    </span>-->
<!--                </td>-->
<!--            `;-->

<!--            tbody.appendChild(row);-->
<!--            });-->
<!--        }-->
<!--     // –ü–µ—Ä–≤—ã–π –≤—ã–∑–æ–≤ –∏ —É—Å—Ç–∞–Ω–æ–≤–∫–∞ —Ç–∞–π–º–µ—Ä–∞-->
<!--     fetchSensorData();-->
<!--     setInterval(fetchSensorData, 5000); // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∫–∞–∂–¥—ã–µ 5 —Å–µ–∫—É–Ω–¥-->
<!--</script>-->


<!--        <div style="clear: both;"></div>-->
<!--    </div>-->
<!--</body>-->
<!--</html>-->